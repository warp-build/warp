<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-JXXV25JQD2"></script>
        <script>
          var localAddrs = ["localhost", "127.0.0.1", ""];

          // make sure we don't activate google analytics if the developer is
          // inspecting the book locally...
          if (localAddrs.indexOf(document.location.hostname) === -1) {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-JXXV25JQD2');
          }
        </script>
        

        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>⚡ Zap Manual</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="⚡ Zap is a build system built for the modern polyglot teams.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
              <h2 style="margin-top: 1rem;">
                ⚡ Zap Manual
              </h2>
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="getting-started/installation.html"><strong aria-hidden="true">2.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="getting-started/first-steps.html"><strong aria-hidden="true">2.2.</strong> First steps</a></li><li class="chapter-item expanded "><a href="getting-started/how-zap-works.html"><strong aria-hidden="true">2.3.</strong> How Zap Works</a></li></ol></li><li class="chapter-item expanded "><a href="changelog/v0.4.2.html"><strong aria-hidden="true">3.</strong> CHANGELOG</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="changelog/v0.4.2.html"><strong aria-hidden="true">3.1.</strong> v0.4.2</a></li><li class="chapter-item expanded "><a href="changelog/v0.4.1.html"><strong aria-hidden="true">3.2.</strong> v0.4.1</a></li><li class="chapter-item expanded "><a href="changelog/v0.4.0.html"><strong aria-hidden="true">3.3.</strong> v0.4.0</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="guides/index.html"><strong aria-hidden="true">4.</strong> Guides</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="guides/mix.html"><strong aria-hidden="true">4.1.</strong> Migrating from mix</a></li><li class="chapter-item expanded "><a href="guides/rebar3.html"><strong aria-hidden="true">4.2.</strong> Migrating from rebar3</a></li><li class="chapter-item expanded "><a href="guides/custom-rules.html"><strong aria-hidden="true">4.3.</strong> Writing custom Rules</a></li></ol></li><li class="chapter-item expanded "><a href="examples/index.html"><strong aria-hidden="true">5.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="examples/hello-world.html"><strong aria-hidden="true">5.1.</strong> Hello World in Erlang / Elixir</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="ref/index.html"><strong aria-hidden="true">6.</strong> Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/cli.html"><strong aria-hidden="true">6.1.</strong> Zap CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/cli/default.html"><strong aria-hidden="true">6.1.1.</strong> zap</a></li><li class="chapter-item expanded "><a href="ref/cli/build.html"><strong aria-hidden="true">6.1.2.</strong> zap build</a></li><li class="chapter-item expanded "><a href="ref/cli/cache.html"><strong aria-hidden="true">6.1.3.</strong> zap cache</a></li><li class="chapter-item expanded "><a href="ref/cli/depgraph.html"><strong aria-hidden="true">6.1.4.</strong> zap depgraph</a></li><li class="chapter-item expanded "><a href="ref/cli/rules.html"><strong aria-hidden="true">6.1.5.</strong> zap rules</a></li><li class="chapter-item expanded "><a href="ref/cli/target.html"><strong aria-hidden="true">6.1.6.</strong> zap target</a></li><li class="chapter-item expanded "><a href="ref/cli/toolchain.html"><strong aria-hidden="true">6.1.7.</strong> zap toolchain</a></li><li class="chapter-item expanded "><a href="ref/cli/workspace.html"><strong aria-hidden="true">6.1.8.</strong> zap workspace</a></li></ol></li><li class="chapter-item expanded "><a href="ref/workspace.html"><strong aria-hidden="true">6.2.</strong> Workspace</a></li><li class="chapter-item expanded "><a href="ref/rules.html"><strong aria-hidden="true">6.3.</strong> Rules</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/rules/archive.html"><strong aria-hidden="true">6.3.1.</strong> archive</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_application.html"><strong aria-hidden="true">6.3.2.</strong> erlang_application</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_library.html"><strong aria-hidden="true">6.3.3.</strong> erlang_library</a></li><li class="chapter-item expanded "><a href="ref/rules/erlang_release.html"><strong aria-hidden="true">6.3.4.</strong> otp_release</a></li></ol></li><li class="chapter-item expanded "><a href="ref/toolchains.html"><strong aria-hidden="true">6.4.</strong> Toolchains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/toolchains/erlang.html"><strong aria-hidden="true">6.4.1.</strong> erlang</a></li></ol></li><li class="chapter-item expanded "><a href="ref/actions.html"><strong aria-hidden="true">6.5.</strong> Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ref/actions/exec.html"><strong aria-hidden="true">6.5.1.</strong> ctx.action().exec</a></li><li class="chapter-item expanded "><a href="ref/actions/copy.html"><strong aria-hidden="true">6.5.2.</strong> ctx.action().copy</a></li><li class="chapter-item expanded "><a href="ref/actions/writeFile.html"><strong aria-hidden="true">6.5.3.</strong> ctx.action().writeFile</a></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><a href="contrib/index.html"><strong aria-hidden="true">7.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="contrib/building.html"><strong aria-hidden="true">7.1.</strong> Building from Source</a></li><li class="chapter-item expanded "><a href="contrib/styleguide.html"><strong aria-hidden="true">7.2.</strong> Style guide</a></li><li class="chapter-item expanded "><a href="contrib/architecture.html"><strong aria-hidden="true">7.3.</strong> Architecutre</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">⚡ Zap Manual</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/AbstractMachinesLab/zap" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>⚡ Zap is a build system built for the modern polyglot teams.</p>
<p>It's built on <a href="https://deno.land">Deno 🦕</a> and <a href="https://rust-lang.org">Rust 🦀</a>,
and maintained by <a href="https://github.com/AbstractMachinesLab">Abstract Machines</a>.</p>
<p>Check out the <a href="./changelog/v0.4.2.html">CHANGELOG</a> to see what's new.</p>
<h2><a class="header" href="#features" id="features">Features</a></h2>
<ul>
<li>Ships only a single executable.</li>
<li>Fast by default. Every step of every build is globally cached and reused.</li>
<li>Designed to be extended. Custom rules and toolchains can be written quickly
and easily in Javascript.</li>
<li>Automatically manages language installations per project for you.</li>
<li>Easy to get started.</li>
</ul>
<h2><a class="header" href="#philosophy" id="philosophy">Philosophy</a></h2>
<p>Zap aims to make working with polyglot monorepos productive and easy.</p>
<p>Monorepos are great for large polyglot codebases, but the tooling to work
efficiently with them is either ecosystem specific (Dune, Lerna), or requires a
large effort upfront (Bazel, Pants, Buck).</p>
<p>Zap aims to be a drop-in solution, so it embraces well-known ecosystem
expectations and conventions to make it as easy as possible to get started.</p>
<h2><a class="header" href="#goals" id="goals">Goals</a></h2>
<ul>
<li>Only ship a single executable (<code>zap</code>)</li>
<li>Provide a simple, fast, and unified experience for polyglot monorepos:
<ul>
<li>manage language and dependency versions per project</li>
<li>build, test, and distribute polyglot projects</li>
</ul>
</li>
<li>Never hear &quot;it works on my machine&quot; again</li>
</ul>
<h1><a class="header" href="#getting-started" id="getting-started">Getting Started</a></h1>
<ul>
<li><a href="getting-started/./installation.html">Installation</a></li>
<li><a href="getting-started/./first-steps.html">First steps</a></li>
<li><a href="getting-started/./how-zap-works.html">How Zap Works</a></li>
</ul>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<p>Zap works on macOS, Linux, and Windows. It is a single binary, and it has no
external dependencies.</p>
<h3><a class="header" href="#using-a-package-manager" id="using-a-package-manager">Using a package manager</a></h3>
<p>If you are a <strong>Rust programmer</strong>, Zap can be installed with <code>cargo</code>.</p>
<pre><code class="language-sh">cargo install zap-build
</code></pre>
<h3><a class="header" href="#manual-binary-installation" id="manual-binary-installation">Manual binary installation</a></h3>
<p>You can manuall install Zap as well on Windows, macOS, or Linux by downloading
the zipped release from Github:
<a href="https://github.com/AbstractMachinesLab/zap/releases/#user-content-assets">github.com/AbstractMachines/zap/releases</a>.</p>
<h3><a class="header" href="#install-from-sources" id="install-from-sources">Install from Sources</a></h3>
<p>Check the <a href="getting-started//contrib/building.html">Building from Source</a> section for up to
date instructions.</p>
<p>If you have Rust and the source code of Zap, you can install it by running <code>make install</code>.</p>
<h1><a class="header" href="#first-steps" id="first-steps">First steps</a></h1>
<h1><a class="header" href="#how-zap-works" id="how-zap-works">How Zap Works</a></h1>
<blockquote>
<p>NOTE: you do not need to be familiar with Rules and Toolchains to <em>use</em> Zap,
but understanding them can help you use it more efficiently.</p>
</blockquote>
<p>There's only a handful of things to get familiar with that will help us
understand how to use Zap more effectively.</p>
<p>These are mirroring concepts that the Bazel build tool has already proven to
work at scale, but they are coloured with the flavors of Dune, that provides an
instant set up.</p>
<p>They are 6:</p>
<ul>
<li>Workspace</li>
<li>Package</li>
<li>Target</li>
<li>Rule</li>
<li>Toolchain</li>
<li>Action</li>
</ul>
<h3><a class="header" href="#workspace" id="workspace">Workspace</a></h3>
<p>This is the dir in your filesystem with all of your project(s) source code.
Typically, this will be your entire Git repository.</p>
<p>Normally you'll have a <code>Workspace.toml</code> file at the root of your repo. We refer
to this as the &quot;workspace root&quot;.</p>
<h3><a class="header" href="#package" id="package">Package</a></h3>
<p>Code is organized in <em>packages</em>, which are named collections
of source files and rules on how to build them. These rules may specify
dependencies on other packages.</p>
<p>1 Package corresponds to 1 <code>Build.toml</code> file.</p>
<p>As an example, the following structure defines 2 packages using their local
paths from the Workspace root.</p>
<ol>
<li><code>//my/app</code>, and</li>
<li><code>//my/app/test</code></li>
</ol>
<pre><code>&lt;workspace root&gt;
├── Workspace.toml
└── my
  └── app
    ├── Build.toml
    ├── data
    ├── main.ex
    └── test
      ├── Build.toml
      └── main_test.exs
</code></pre>
<p>You have full control on how you organize packages so it can best reflect
the structure of your project(s).</p>
<p>The more granular packages you have, the faster incremental rebuilds can be.</p>
<h3><a class="header" href="#target" id="target">Target</a></h3>
<p>As we saw above, every Package has a number of named definitions. These we call
<em>Targets</em> and they represent the specific things being built or run within a
Package.</p>
<p>A target always consists of 2 things:</p>
<ul>
<li>a <code>rule</code>, and</li>
<li>a <code>name</code>,</li>
</ul>
<p>Depending on the <code>rule</code>, the target may have more parameters.</p>
<p>For example, library targets have tend to have sources (<code>srcs</code>), while test
targets have a single source (<code>src</code>). All rules have ecosystem aware defaults.</p>
<p>Here's an Elixir library and its corresponding test, also written in Elixir.</p>
<pre><code class="language-toml"># file: &lt;workspace-root&gt;/my/app/Build.toml
[[elixir_library]]
name = &quot;lib&quot;
srcs = [ &quot;*.ex&quot; ]  # this isn't needed, as it is the default

# file: &lt;workspace-root&gt;/my/app/test/Build.toml
[[elixir_test]]
name = &quot;main_test&quot;
src = &quot;main_test.exs&quot;
deps = [&quot;:lib&quot;]
</code></pre>
<p>The <code>name</code> of a target defines its <strong>Label</strong>. Label's are package paths, as
we saw above, with the target name at the end.</p>
<p>In this case, because the package path of the library is
<code>&lt;workspace-root&gt;/my/app</code>, the Label will be <code>//my/app:lib</code>.</p>
<p>We use <code>//</code> as a shorthand for <code>&lt;workspace-root&gt;</code>.</p>
<h3><a class="header" href="#rules" id="rules">Rules</a></h3>
<p>Rules define how to go from a set of inputs to a set of outputs. The name of
the rule defines what actions will be taken.</p>
<p>So for example, an <code>[[elixir_library]]</code> rule will be different from an
<code>[[gleam_library]]</code> rule, even if they both create the same set of outputs.</p>
<p>We're following a pattern of naming that prefixes common rules with the
language they support:</p>
<ul>
<li><code>*_library</code> for library</li>
<li><code>*_test</code> for tests</li>
<li><code>*_shell</code> for REPLs (whenever available)</li>
</ul>
<p>Which yields:</p>
<ul>
<li><code>erlang_library</code>, <code>elixir_library</code>, etc</li>
<li><code>erlang_test</code>, <code>elixir_test</code>, etc</li>
<li><code>erlang_shell</code>, <code>elixir_shell</code>, etc</li>
</ul>
<h3><a class="header" href="#toolchains" id="toolchains">Toolchains</a></h3>
<p>Many rules share certain tools to perform their work. For example, all the
Elixir rules need a working Elixir installation.</p>
<p>It would be too much work to specify that every target depends <em>also</em> on the
specific language toolchain, so instead we deal with this at the Rule level.</p>
<p>All rules define what toolchains they rely on, and Zap will build and cache
them like any other target.</p>
<h3><a class="header" href="#action" id="action">Action</a></h3>
<p>Every rule creates a series of Actions that Zap needs to carry out. These
actions can be to execute a program, copy a file, or write a new file.</p>
<p>It is these actions that actually make rules <em>do work</em>.</p>
<h1><a class="header" href="#v042-separate-archive-cache" id="v042-separate-archive-cache">v0.4.2: Separate Archive Cache</a></h1>
<p><a href="https://github.com/AbstractMachinesLab/zap/releases/tag/v0.4.2#user-content-assets">You can download this release from Github</a></p>
<h3><a class="header" href="#-separate-archive-cache" id="-separate-archive-cache">📦 Separate Archive Cache</a></h3>
<p>Toolchains are now build like anything else on the build graph, but the toolchain's archives will be saved under a separate cache.</p>
<p>This makes it possible to both break a toolchain cache without redownloading
the archive (e.g, if we just need to rebuild it with different parameters), but
also to not accidentally assume a toolchain is built just because we have
downloaded it correctly.</p>
<p>Thanks @idkjs for helping find and debug this with issue #5.</p>
<div id="assets"></div>
<h1><a class="header" href="#v042-separate-archive-cache-1" id="v042-separate-archive-cache-1">v0.4.2: Separate Archive Cache</a></h1>
<p><a href="https://github.com/AbstractMachinesLab/zap/releases/tag/v0.4.2#user-content-assets">You can download this release from Github</a></p>
<h3><a class="header" href="#-separate-archive-cache-1" id="-separate-archive-cache-1">📦 Separate Archive Cache</a></h3>
<p>Toolchains are now build like anything else on the build graph, but the toolchain's archives will be saved under a separate cache.</p>
<p>This makes it possible to both break a toolchain cache without redownloading
the archive (e.g, if we just need to rebuild it with different parameters), but
also to not accidentally assume a toolchain is built just because we have
downloaded it correctly.</p>
<p>Thanks @idkjs for helping find and debug this with issue #5.</p>
<div id="assets"></div>
<h1><a class="header" href="#v041-more-rule-actions-workspace-outputs-bugfixes" id="v041-more-rule-actions-workspace-outputs-bugfixes">v0.4.1: More rule actions, workspace outputs, bugfixes</a></h1>
<p><a href="https://github.com/AbstractMachinesLab/zap/releases/tag/v0.4.1#user-content-assets">You can download this release from Github</a></p>
<h3><a class="header" href="#-new-rule-actions" id="-new-rule-actions">🏃 New Rule Actions</a></h3>
<p>In our test project I'm building support for the Erlang toolchain, and so new actions
are becoming necessary. So far we've had <code>ctx.action().exec({cmd, args, cwd})</code> but now you can also use</p>
<p><code>ctx.action().copy({src, dst})</code> to copy a file. This action is at the moment
quite permissive and <em>it will overwrite the <code>dst</code></em>, so use it with care. In the
future it will be restricted to only read from paths that are within the
sandbox, and only write to paths that would exist within the sandbox too and
that are also declared.</p>
<p><code>ctx.action().writeFile({data, dst})</code> will let you write a file. This works
similarly to the Copy action, except that there's no source file. Instead you can use JavaScript string literals to create the contents.</p>
<p>For example</p>
<pre><code class="language-javascript">const A_CONSTANT = &quot;2112&quot;;

ctx.action().writeFile({
  data: ` My template: ${A_CONSTANT}`,
  dst,
});
</code></pre>
<h3><a class="header" href="#-zap-outputs" id="-zap-outputs">🗃️ Zap Outputs</a></h3>
<p>In <a href="changelog//changelog/v0.4.0.html">v0.4.0</a> I mentioned the <code>zap-outputs</code> but there was a bug where if you tried to execute Zap concurrently, the symlinking would fail.</p>
<p>This has been fixed now, which also helps us write more tests.</p>
<h1><a class="header" href="#v040-userland-rules-rebrand-and-global-cache-" id="v040-userland-rules-rebrand-and-global-cache-">v0.4.0: Userland rules, rebrand, and global cache! ⚡</a></h1>
<p><a href="https://github.com/AbstractMachinesLab/zap/releases/tag/v0.4.0#user-content-assets">You can download this release from Github</a></p>
<h3><a class="header" href="#-new-name" id="-new-name">⚡ New name!</a></h3>
<p>And we've got the manual website up, and a twitter account. Getting more
serious with this as an Abstract Machiness FOSS tool 🚀 </p>
<p>Twitter: <a href="https://twitter.com/zap_build">@zap_build</a></p>
<p>WWW: <a href="https://zap.build">zap.build</a></p>
<h3><a class="header" href="#-reworked-cli-targets" id="-reworked-cli-targets">💻 Reworked CLI Targets</a></h3>
<p>Zap is set up now to provide high-level commands, but also comes with a number
of subcommands to inspect the Workspace status and your targets. All the
targets share a common setup step where they'll validate the entire workspace
and bootstrap it if they find a Workspace.toml file.</p>
<p>You can call:</p>
<p><code>zap help</code> to get help on any command.</p>
<p><code>zap rules</code> to inspect the rules that are available, and even print out what
are the steps needed to carry them out are, and what outputs they would create.</p>
<p><code>zap workspace info</code> lets you inspect your workspace configuration and paths.</p>
<p><code>zap toolchains</code> lets you manage your toolchains and inspect which ones are
available, installed, and configured.</p>
<p><code>zap target list</code> lets you list all the workspace targets</p>
<p><code>zap depgraph print [target]</code> will give you the dependency graph in GraphViz
Dot format. Take it over to edotor.net and make some pretty graphs! But also
remember you can pass in a specific build target to this command, to show the
relevant subset of the build graph that is needed to build it.</p>
<p><code>zap cache clear [target]</code> will clear from the cache a single target. Use
sparingly, and if it fixes your build, this is a bug! (Assuming you're not
writing custom rules, etc).</p>
<p>Lastly <code>zap build [target]</code> will build the target.</p>
<p>And my favorite, <code>zap</code> is an alias to <code>zap build //...</code>.</p>
<h3><a class="header" href="#-workspacetoml-and-buildtoml" id="-workspacetoml-and-buildtoml">🗃️ Workspace.toml and Build.toml</a></h3>
<p>The old <code>workspace</code> and <code>crane</code> files needed additional annotations to get good
editor support, and that was kind of a drag. Instead Zap is embracing TOML as
its configuration format.</p>
<p>The <code>workspace</code> file now becomes <code>Workspace.toml</code>, and the <code>crane</code> file used to
designate build packages is now called <code>Build.toml</code>.</p>
<h3><a class="header" href="#--toolchains-are-part-of-the-build-graph--now" id="--toolchains-are-part-of-the-build-graph--now">🧰  Toolchains are part of the Build Graph  now</a></h3>
<p>This means that Zap will only build them if you need to build a particular
library with them! </p>
<p>For example, say you have configured the Deno and Elixir toolchains in your
Workspace.toml file.</p>
<p>If you never build anything that relies on the Elixir toolchain, Zap won't
build it.</p>
<p>So if you want to build the entire thing, just run <code>zap</code>! All of the targets
will be built, and only the toolchains that are required will be built.</p>
<h3><a class="header" href="#-extensible-rules-and-toolchains-in-javascript" id="-extensible-rules-and-toolchains-in-javascript">🔧 Extensible Rules and Toolchains in JavaScript</a></h3>
<p>You can write them in JavaScript and they will run with an embedded Deno
runtime. This is kind of huge because in ~50 lines of JS you can integrate any
new language or tool, and create custom rules that will override the default
ones.</p>
<p>In the future we will restrict what Javascript can be written, to help you
write better rules and toolchains. This restrictions will make JavaScript a
<em>non-turing complete language</em>, which I think we'll call BuildScript.</p>
<p>There'll be more of this written in the https://zap.build website</p>
<h3><a class="header" href="#-global-cache-local-sandboxing-and-local-outputs" id="-global-cache-local-sandboxing-and-local-outputs">🥪 Global cache, local sandboxing, and local outputs</a></h3>
<p>Zap keeps a global cache in <code>~/.cache/zap/_user_${USER}/cache</code> and there you'll
find the toolchains and all of the things that are being built. This cache
structure is internal, and will change over time.</p>
<p>To help you access your project's outputs, Zap now symlinks a <code>zap-outputs</code>
folder to the root of your workspace where you can find a tree with all of the
outputs.</p>
<p>This tree will be reconciled every time you build, so its safe to remove.</p>
<h3><a class="header" href="#-single-super-tiny-binary" id="-single-super-tiny-binary">📦 Single, super tiny binary!</a></h3>
<p>All of this and we're still managing to publish a tiny binary that is just under 6 mb compressed 👌🏼 -- thank goodness to the Rust ecosystem for the tips &amp; tricks.</p>
<p>Multi-architecture releases supported by Github Actions are out as well.</p>
<h1><a class="header" href="#guides" id="guides">Guides</a></h1>
<h1><a class="header" href="#migrating-from-mix" id="migrating-from-mix">Migrating from mix</a></h1>
<h1><a class="header" href="#migrating-from-rebar3" id="migrating-from-rebar3">Migrating from Rebar3</a></h1>
<h1><a class="header" href="#writing-custom-rules" id="writing-custom-rules">Writing custom Rules</a></h1>
<h1><a class="header" href="#examples" id="examples">Examples</a></h1>
<h1><a class="header" href="#hello-world" id="hello-world">Hello World</a></h1>
<h1><a class="header" href="#reference" id="reference">Reference</a></h1>
<h1><a class="header" href="#zap-cli" id="zap-cli">Zap CLI</a></h1>
<h1><a class="header" href="#zap" id="zap">zap</a></h1>
<h1><a class="header" href="#zap-build-target" id="zap-build-target">zap build [target]</a></h1>
<h1><a class="header" href="#zap-cache" id="zap-cache">zap cache</a></h1>
<h1><a class="header" href="#zap-depgraph" id="zap-depgraph">zap depgraph</a></h1>
<h1><a class="header" href="#zap-rules" id="zap-rules">zap rules</a></h1>
<h1><a class="header" href="#zap-target" id="zap-target">zap target</a></h1>
<h1><a class="header" href="#zap-toolchain" id="zap-toolchain">zap toolchain</a></h1>
<h1><a class="header" href="#zap-workspace" id="zap-workspace">zap workspace</a></h1>
<h1><a class="header" href="#workspace-1" id="workspace-1">Workspace</a></h1>
<h1><a class="header" href="#rules-1" id="rules-1">Rules</a></h1>
<h1><a class="header" href="#archive" id="archive">archive</a></h1>
<h1><a class="header" href="#erlang_application" id="erlang_application">erlang_application</a></h1>
<h1><a class="header" href="#erlang_library" id="erlang_library">erlang_library</a></h1>
<h1><a class="header" href="#erlang_release" id="erlang_release">erlang_release</a></h1>
<h1><a class="header" href="#toolchains-1" id="toolchains-1">Toolchains</a></h1>
<h1><a class="header" href="#clojerl" id="clojerl">clojerl</a></h1>
<h1><a class="header" href="#actions" id="actions">Actions</a></h1>
<h1><a class="header" href="#ctxactionexec" id="ctxactionexec">ctx.action().exec</a></h1>
<h1><a class="header" href="#ctxactioncopy" id="ctxactioncopy">ctx.action().copy</a></h1>
<h1><a class="header" href="#ctxactionwritefile" id="ctxactionwritefile">ctx.action().writeFile</a></h1>
<h1><a class="header" href="#contributing" id="contributing">Contributing</a></h1>
<h1><a class="header" href="#building-from-source" id="building-from-source">Building from Source</a></h1>
<p>Zap is built with Rust, so it needs a working installation of the Rust toolchain.
If you are using <code>rustup</code>, the <code>stable</code> toolchain should suffice.</p>
<p>Additionally, we use <code>make</code>, since it makes our CI steps pretty minimal.</p>
<h3><a class="header" href="#getting-started-1" id="getting-started-1">Getting Started</a></h3>
<p>The next scripts show how to set up Zap and create a release:</p>
<pre><code class="language-sh"># install rust first
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# clone the repository
git clone git@github.com:AbstractMachinesLab/zap.git
cd zap

# install all required dependencies
make setup

# compile projects and runs the tests
make test

# installs project from sources
make install
</code></pre>
<h3><a class="header" href="#common-tasks" id="common-tasks">Common Tasks</a></h3>
<p>To bootstrap the repository, you can run <code>make setup build</code>.</p>
<p>To compile the manual, you can run <code>make manual</code>.</p>
<p>To run all the tests, you can run <code>make test</code>.</p>
<p>To install the local version, you can run <code>make install</code>.</p>
<p>To format all the code, you can run <code>make fmt</code>.</p>
<p>To create a release of Zap, you can run <code>make release</code>, or <code>make release.win</code> on
Windows.</p>
<h1><a class="header" href="#style-guide" id="style-guide">Style guide</a></h1>
<h1><a class="header" href="#architecutre" id="architecutre">Architecutre</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
